% ENORMOUS credit for the foundational formatting
%   of these notes goes to Patrick Lei. 
% Check out his fantastic course notes
%   here: https://git.snopyta.org/abstract/course-notes
% and his website 
%   here: https://www.math.columbia.edu/~plei/index.html

\documentclass[twoside, 10pt]{article}
\usepackage{bbnotes}
\geometry{margin=2cm}

\definecolor{darkblue}{RGB}{0,0,128}
\definecolor{darkred}{RGB}{128,0,0}
\definecolor{darkyellow}{RGB}{96,96,0}
\definecolor{darkgreen}{RGB}{0,128,0}
\definecolor{darkdarkred}{RGB}{64,0,0}

\lstset
{
basicstyle=\ttfamily\scriptsize, 
breaklines=true,
postbreak=\mbox{\textcolor{darkdarkred}{$\hookrightarrow$}\space},
showstringspaces=false
keywordstyle = [1]\bfseries\color{darkred},
keywordstyle = [2]\itshape\color{darkgreen},
keywordstyle = [3]\sffamily\color{darkblue},
keywordstyle = [4]\color{darkyellow},
}

\fancypagestyle{firstpage}
{
   \fancyhf{}
   \fancyfoot[R]{\itshape Page \thepage\ of \pageref{LastPage}}
   \renewcommand{\headrulewidth}{0pt}
}


\fancypagestyle{pages}
{
\fancyhead[C]{\scshape Math 571}
\fancyhead[L]{\scshape Ben Burns}
\fancyhead[R]{\scshape Spring 2022}
\renewcommand{\headrulewidth}{0.1pt}
}

\pagestyle{pages}

\title{Math 571}
\author{Taught by Tom Weston \\ Scribed by Ben Burns}
\affil{UMass Amherst}
\date{Spring 2022}

\newcommand{\F}{\mathbb{F}}
\renewcommand{\O}{\mathbb{O}}
\usepackage{algorithmicx}

\begin{document}

\maketitle\thispagestyle{firstpage}

\tableofcontents

\section{First Exam}
\begin{rmk}
    I did not take notes for the first third of the course. This section serves as an index of what the reader is missing.
\end{rmk}
\begin{itemize}
    \item Discrete Logs
    \item Diffie-Hellman Key Exchange
    \item Shanks Algorithm
    \item RSA
    \item Factorization (p-1 method, trial division, difference of squares)
\end{itemize}
\begin{exm}
    Fiven a few explicity congruences $c_i \equiv a_i^2\pmod{n}$ explain how you can find a factor of $n$
\end{exm}

\section{Factorization by difference of squares}
(1) Find lots of congruences $a_1^2 \equiv c_i \pmod{n}$ with $c_i$ product of small primes. Fix small number $B$, and require all prime factors $p \leq B$\\
(2) Elimination: Find a subset of these congruences which multiply to give $x^2 \equiv y^2 \pmod{n}$ ($\F_2$ linear algebra)\\
(3) Compute $\gcd(x\pm y, n)$, hope its a proper factors of $n$

Review finding kernel, Gaussian Elimination $\F_2$, book of (2)

\textbf{Algorithm}: Find numbers $a$ such that $a^2 \pmod{n$} is a product of small primes

$m = \left\lfloor \sqrt{n}\right\rfloor + 1$. Try $a = m, m + 1, m+2, \cdots$, $a^2 \pmod{n} = a^2 - n$. 

This is relatively small since $a \approx\sqrt n$, so has a better chance of factoring into small primes

$Q(x) = x^2 - n$

Looking at $x = m, m+1, m+2$, we find $x^2 \equiv Q(x) \pmod{n}$, where $x^2 = a_i$ and $Q(x) = c_i$.

\textbf{Problem}: Given $n, a$, how do you determine if $Q(a) = a^2 - n$ is a product of small primes without factoring?

%Todo: What is a KMatrixSpace

\begin{rmk}
    Roughly half of primes will never be factors of $Q(a)$
\end{rmk}
Why? Suppose $p | Q(a)$ for some $a$. Then $p | a^2 - n \implies a^2 \equiv n \pmod{p} \implies$ $n$ is a square mod $p$.

Fix odd prime $p$

\begin{defn}
    Given $t\in \F_p$ such that $t\neq 0$, we say $t$ is a quadratic residue mod $p$ if $\exists s \in \F_p$ such that $s\equiv s^2 \pmod{p}$
\end{defn}
For example, $p=11$

"Squares are always squares" - :D

There are always exactly $\dfrac{p-1}{2}$ squares and $\dfrac{p-1}{2}$ non-squares 

\subsection{Legendre Symbols}
\begin{defn}[Legendre Symbol]
    $\left(\dfrac{t}{p}\right) = +1$ if $t$ square mod $p$, $-1$ if $t$ non-square, $0$ if $t = 0 \pmod{p}$.
\end{defn}

\begin{rmk}
    The quadratic resides of $\F_p$ are the even powers of any generator $g$.
\end{rmk}
Fix a generator $g\in \F_p$. Fix $t\in \F_p$. Write $t = g^e$ for some $e$ s.t $0\leq e \leq p-1$. If $e$ is even then $t = (g^{e/2})^2 \implies \left(\dfrac{t}{p}\right) = 1$. Since this already gives $(p-1)/2$ squares for $e = 0, 2, 4, \ldots p-3$, so it follows that $e$ odd $\implies \left(\dfrac{t}{p}\right) = -1$.

\begin{defn}[Properties of Legendre Symbol]
    (1) $\left(\dfrac{t}{p}\right) \equiv t^{\dfrac{p-1}{2}} \pmod{p}$\\
    (2) $\left(\dfrac{st}{p}\right) = \left(\dfrac{s}{p}\right)\left(\dfrac{t}{p}\right)$\\
    (3) $\left(\dfrac{-1}{p}\right) = (-1)^{\dfrac{p-1}{2}} = 1$ if $p\equiv 1\pmod{4}$, $-1$ is $p\equiv 3\pmod{4}$
\end{defn}
Proof:\\ 
%Todo: fill out
(1) FLT for squares, polynomial counting argument for non-squares\\
(2) right side of (1) is multplicative, so left side has to be as well\\
(3) 

\begin{defn}[Quadratic Reciprocity Law]
    Let $p, q$ be distinct odd positive primes. Then $\left(\dfrac{p}{q}\right) = \dfrac{q}{p}(-1)^{\dfrac{p-1}{2}\dfrac{q-1}{2}}$.
\end{defn}
Equivalently, if either $p$ or $q$ is congruent to 1 mod 4, then the reciprocity holds. Else, they are negations.
\begin{defn}[Quadratic Sieve] 
    
\end{defn}
Manufacture many congruences of the form $c_i \equiv a_i^2 \pmod{n}$ where $a_i$ where $a$ is a product of primes less than some fixed bound $B$

Set $Q(x) = x^2 - n$, then try $Q(m), Q(m + 1) \cdots$, where $m = \rfloor\sqrt n \lfloor + 1$. To check if $Q(a_i)$ is only divisible by primes $\leq B$ we use a sieve to simultaneously find all small prime factors of $Q(x)$ via linear congruences. 

\begin{defn}
    Fix B. An integer $m$ is $B$-smooth if all primes factors of $m$ are $\leq B$
\end{defn}

\begin{defn}
    $\psi(x, B) = $ \# $B$-smooth numbers $\leq x$
\end{defn}

\begin{thm}
    Let $L(x) = e^{\sqrt{\ln x \cdot \ln\ln x}}$. Fix $0 < c < 1$. Then $\psi(x, L(x)^c) = xL(x)^{-\dfrac{1}{2c}(1 + o(1))}$
\end{thm}
This holds if you replace $o(1)$ by some constant, and that constant goes to 0 as $x\to\infty$

\section{Elliptic Curves}
In the 1980s, Lenstra found a way to apply the very developed theory of elliptic curves to cryptography and factorization. 

\begin{defn}
    An elliptic curve is a plane cubic curves given by an equation $y^2 = x^3 + ax + b$ with $a, b \in \Q$ s.t $\Delta = 4a^3 + 27b^2 \neq 0$
\end{defn}

\begin{rmk}
    Most general equation, the Weierstrass equation: $y^2 + a_1xy + a_3y = x^3 + a_2x^2 + a_4x + a_6$
\end{rmk}

\subsection{Point addition}
Define $E := y^2 = x^3 + ax + b$. The key thing is the addition law. Given $P, Q$ points on $E$, construct a third point $P \oplus Q$

\begin{thm}[Bezout's Theorem]
    A curve of degree $d$ and a curve of degree $d'$ have $dd'$ points of intersection
\end{thm}
Two cocentric circles won't have any intersections $\to$ requires complex numbers. 

Take elliptic curve of degree 3, and a line of degree one. By Bezout's Theorem, there will be two points of intersection. Two of which are $P$ and $Q$, and call the third $R$. Set $P \oplus Q$ to be the reflection of $R$ across the $x$-axis. With a few other conditions, we get a group law.

\begin{exm*}
    $y^2 = x^3 - 15x + 18$. $P$ = (7, 16) $Q$ = (1, 2)
\end{exm*}
$y - 2 = \dfrac{7}{3}(x-1) \implies y = \dfrac{7}{3}x - \dfrac{1}{3}$. Insert into elliptic curve $(\dfrac{7}{3}x - \dfrac{1}{3}) = x^3 - 15x + 18 \implies \dfrac{49}{9}x^2 - \dfrac{14}{9}x + \dfrac{1}{9} = x^3 - 15x + 18 \implies x^3 - \dfrac{49}{9}x^2 + \ldots = 0$. Move all terms to one side, and solve the cubic. 

Don't need the cubic equation, because we know that $P$ and $Q$ are on the intersection, or $x = 7$ and $x = 1$ are two zeros. $(x - 1)(x - 7)(x - x_0) \implies x^3 - (8 + x_0)x^2 + \ldots$, equate the quadratic coefficients $\dfrac{-49}{9}$ = $-(8 + x_0) \implies x_0 = \dfrac{-23}{9}$. Therefore $R$ has an $x$ value of $\dfrac{-23}{9}$. 

Caveats: if we take the same point twice, take the tangent line rather than a secant line. If you take two points on a vertical line, your third is the projective point at infinity.

$E(\R) = \{(x, y) \in \R^2 | y^2 = x^3 + ax + b\} \cup \{\O\}$, where $\O$ is the point at infinity.

Assuming we have the two points $P = (x_1, y_1)$ and $Q = (x_2, y_2)$, where $x_1 \neq x_2$.

1) (Secant) Line PQ\\
$Y = y_1 + \lambda(X - x_1), \lambda = \dfrac{y_2 - y}{x_2 - x}$

2) Insert into cubic\\
$(y_1 + \lambda(X - x_1))^2 = X^3 + aX + b$\\
$0 = X^3 + (-\lambda)X^2 + \ldots$

We know this must factor into $(X-x_1)(X-x_2)(X-x_3)$ since $P$ and $Q$ are on the line and on $E$.

3) Equate coefficient of $X^2$\\
$-\lambda^2 = -(x_1 + x_2 + x_3)$\\
$x^3 = \lambda^2 - x_1 - x_2$

4) Plug $X = x_3$ into line\\
$y_3 = t_1 + \lambda(x_3 - x_1)$

5) $P\oplus Q = (x_3, -y_3)$

\begin{rmk}
    This exercise is not to suggest memorizing this algorithm, just to demonstrate that there is a general solution method for two points with distinct $x$ values on $E$.
\end{rmk}

\subsection{Special Cases} Now we address more special cases of point addition

1) $\O \oplus Q = Q$, $P \oplus \O = P$.

2) $P = (x, y)$\\
$-P = (x, -y)$ (reflection across $x$-axis)\\
$P \oplus -P = \O$\\

3) $P \oplus P$: The only difference from the general case is that, here, $\lambda$ is the slope of the tangent line of $E$ at $P$, which can be determined by implicit differentiation $\implies 2YY' = 3X^2 + a \implies Y'  = \dfrac{3X + a}{2Y} \implies \lambda = \dfrac{3x_1^2 + a}{2y_1}$. 

\begin{rmk}
    In this 3rd case, if $y_1$ is zero, this obviously doesn't work. However, that is just where $P$ is on the $x$-axis, and is therefore its own reflection, so $P \oplus P = P \oplus -P = \O$
\end{rmk}

\begin{prop}
    $E(\R) = \{(x, y) \in \R^2 | y^2 = x^3 + ax + b\} \cup \{\O\}$, where $\O$ is the point at infinity, is an abelian group under the operation $\oplus$ with identity $\O$. 
\end{prop}
\textbf{Proof}\\
Binary operation $\oplus$ which preserves $E(\R)$. Check axioms.

1) Identity: $P \oplus \O = \O\oplus P = P$ for all $P$.

2) Inverses: $P \oplus -P = \O$

3) Abelian: Computing secant lines with different order of endpoints gives the same line, so $\oplus$ commutes

4) Associativity: In principle, this can be done by algebra with exhaustive case study. Alternatively, \\
$\to$ 4.1) do this in projective geometry, use Pascal's theorem\\
$\to$ 4.2) Develop theory of algebraic curves enough, it becomes obvious (tensor product with Picard group, that is a group and is associative, so this is associative)

\subsection{Introducing other fields}
\begin{rmk}
    We don't actually care about $E(\R)$, but variations are useful in cryptography
\end{rmk}

\begin{defn}
    $E(\Q) = \{(x, y) \in \R^2 | y^2 = x^3 + ax + b\} \cup \{\O\} \subset E(\R)$
\end{defn}

\begin{rmk}
    It is possible for there to be no rational points and $E(\Q)$ is just $\O$
\end{rmk}

\textbf{Claim}: $E(\Q)$ is a subgroup of $E(\R)$ under $\oplus$

1) $\O \in E(\Q)$ (either by definition of $E(\Q)$ or since $\O$ is (0, 0, 1) in projective geometry

2) $P \in E(\Q) \implies -P \in E(\Q)$, obvious since $-P = (x_1, -y_1)$

3) $P, Q \in E(\Q) \implies P\oplus Q \in E(\Q)$. All special cases are obvious. For the general case, all of the suboperations are closed under rational numbers, so the entire operation is a rational operation.

\begin{rmk}
    A field is a set $K$ with operations $+, \cdot$ satisfying a collection of axioms that satisfy all the expected axioms as under real numbers ($+, -, \cdot, /$)
\end{rmk}

\begin{exm*}
    $R, \Q, \C, \F_p = \Z/p$ where $p$ prime.
\end{exm*}

\begin{rmk}
    Modulus has to be prime since $\Z/n$ can have elements without an inverse (not even integral domain)
\end{rmk}

\begin{defn}
    For field $K$, an elliptic curve over $K$ is $Y^2 = X^3 + aX + b$ where $a, b \in K$ s.t $\Delta_E = 4a^3 + 27b^2 \neq 0$.
\end{defn}

$E(K) = \{(x, y) \in K \times K | Y^2 = X^3 + aX^2 + b \in K\} \cup \{\O\}$ is an abelian group under $\oplus$. 

\begin{exm*}
    $E(\F_p) = \{(x, y) \in \F_p^2 | Y^2 = X^3 + aX^2 + b\pmod{p}\} \cup \{\O\}$\\
    $E = y^2 = x^3 + x + 1, K = \F_p$
\end{exm*}

\begin{tabular}{c|c|c}
    $x$ & $x^3 + x + 1$ & $y$ s.t $y^2 = x^3 + x + 1$\\
    \hline
    0 & 1 & $\pm$ 1\\
    1 & 3 & $X$\\
    2 & 4 & $\pm$2\\
    3 & 3 & $X$\\
    4 & 6 & $X$\\
    5 & 5 & $X$\\
    6 & 6 & $X$\\
\end{tabular}

$E(\F_7) = \{\O, (0, 1), (0, -1), (2, 2), (2, -2)\}$

$(0, 1) \oplus (2, 2)$

$\lambda = \dfrac{2-1}{2-0} = \dfrac{1}{2} = 4$\\
$\implies x_3 = \lambda^2 - x_1 - x_2 = 16 - 0 - 2 = 14 = 0$\\
$\implies y_3 = 1 + 4(0 - 0) = 1$\\
$\implies (0, 1) \oplus (2, 2) = -(0, 1) = (0, -1)$

\subsection{Classifying E} What kind of groups are we getting?

\begin{exm*}
    $E(\F_p)$ is a finite abelian group. $|E(F_p)| \leq p^2 + 1$, but we can do far better, since for each $x$ coordinate can give us at most 2 $y$ coordinates, so $|E(F_p)| \leq 2p + 1$.
\end{exm*}
This bound still isn't best, but it's better

\begin{exm*}
    $E(\R)$ is either $S^1$ or $S^1 \times \Z/2$, where $S^1$ is the circle group under addition of angles.
\end{exm*}
Which one it is is detectable based on how many roots $E$ has. Only 1 compact lie group of dimension 1, which is $S^1$.

\begin{exm*}
    $E(\C)$ is the torus, $S^1 \times S^1$
\end{exm*}

\begin{thm}[Mordell-Weil Theorem]
    $E(\Q)$ is a finitely generated abelian group $\implies E(\Q) \cong \Z^r \times T$, where $r \geq 0$, and $T$ is the torsion group. (which is finite) %Todo: research this
\end{thm}


\begin{exm*}
    $E(\Q) \cong \Z$, there is a point $P_0 \in E(\Q)$ s.t every point in $E(\Q)$ is $nP_o$ for some $n\in \Z$
\end{exm*}
$nP_o$ := $P_o \oplus P_o \oplus \cdots \oplus P_o$ for $n > 0$, or $-P_o \oplus -P_o \oplus \ldots \oplus -P_o$ for $n < 0$.

\begin{thm}[Mazar, 1977]
    $\begin{cases}
        T \cong \Z/n & n = 1, 2, \ldots, 10, 12\\
        T \cong \Z/2 \times \Z/n & n = 2, 4, 6, 8\\
    \end{cases}$
\end{thm}

"Mazar is the best number theorist of the 20th century, but I'm a bit biased" - man advised by Mazar.

What about $r$? Called the rank. $r$ is 0, 50\% of the time, and $r = 1$ 50\%. $r \geq 2$ occurs but rarely. Record $r$ is probably around 30, hypothesis is that $r$ is unbounded.

There are certain algorithms to compute $r$ and $E(\Q)$

\begin{rmk}
    There is a conjectural analytic formula for $r$. Birch and Swinnerton-Dyer %Todo: research https://scholar.rose-hulman.edu/cgi/viewcontent.cgi?article=1028&context=rhumj
\end{rmk}

% \begin{rmk}
%     Silverman + Tate: Rational Points on Elliptic Curves. Should be at the level we can understand, at the cost of using less effective algebraic arguments at times
% \end{rmk}

\section{Elliptic Curves over Finite Fields}
$E : y^2 = x^3 + ax^2 + b$, where $a, b \in \F_p$

How big can $E(\F_p)$ be? 

How to compute?

First approach: for each $x = x_0$, look at $x_0^3 + ax_0 + b$.$= \left(\dfrac{x_0^3 + ax_0^2 + b}{p}\right) + 1$ (Legandre symbol)\\$\implies$ if this is a nonzero square, 2 points. For nonsquare, 0 points. zero, 1 point. 

$|E(\F_p)| = \sum\limits_{x_0=0}^{p-1}\left(\dfrac{x_0^3 + ax_0^2 + b}{p}\right) + 1 + 1 = p + 1 + \sum\limits_{x_0=0}^{p-1}\left(\dfrac{x_0^3 + ax_0^2 + b}{p}\right)+ 1$ 

Since $\left(\dfrac{a}{p}\right)$ is 1 or -1 equally often, expect sum to be fairly small.
\begin{thm}[Riemann Hypothesis for elliptic curves over finite fields]
    $|\sum\limits_{x_0=0}^{p-1}\left(\dfrac{x_0^3 + ax_0^2 + b}{p}\right)| \leq 2\sqrt p$, 
\end{thm}
Really called the Hasse Theorem, but Hasse applied to the Nazi party, and Weston doesn't cite Nazis

$N_p = \#E(\F_p)$\\
$a_p = p + 1 - \#E(\F_p)$\\
$|a_p| \leq 2\sqrt{p}$\\
$|\#E(\F_p) - p - 1| \leq 2\sqrt p$

\begin{rmk}
    \# $E(\F_p) = p + 1$, where everything cancels out, is the supersingular case.
    \# $E(\F_p) = p \to$ "anomolous primes", discrete log problem is really easy to solve %Todo: why
\end{rmk}

\subsection{Algorithms to compute \#E(F)}
Given $E/\F_{101}$, suppose we have $P \in E/\F_{101}$ of order 47. This directly implies that \#$E(\F_p) = 94$.

Why? Riemann hypothesis tells us that the number of points must be within $|\#E(\F_p) - 102| \leq 20 \implies 82 \# \leq \#E(\F_p) \leq 122$. Lagrange's theorem tells us that, since $E/\F_{101}$ is finite, then order of $P$ must divide $\#E(\F_p)$. The only number that satisfies both of these properties is 94.

To compute $\#E(\F_p)$: find orders of elements until Lagrange forces a unique possible field order via Riemann Hypothesis.

How to find orders?\\
1) Shanks Baby Step -- Giant Step (Collision): take big powers and find collision. Going to take $O(\sqrt{p})$, might need to make multiple tries before you get a useful collision

2) Schoof (Elkies + Atkin). Using division polynomials, runs in $O(\log^6 p)$. The constants were originally huge, so you need lots of digits for it to be useful/practical.

\begin{rmk}
    Any finite abelian group can be expressed as the product of finite cyclic groups. $E(\F_p)$ can be a product of at most two cyclic groups: $E(\F_p) \cong \Z/st \times \Z/s$, where $t$ is large and $s$ is small. For example, prime $l | s \approx \dfrac{1}{l^4}$
\end{rmk}

\begin{exm*}
    Another way to look at RH. Take $y^2 = x^3 - 7x - 6$. Vary $p$, count $\#E(F_p)$ for each $p$, and compare to Riemann hypothesis
\end{exm*}

\begin{tabular}{c|c|c}
    $p$ & $\#E(\F_p)$ & $p + 1 - \#E(\F_p) \leq 2\sqrt{p}$\\
    \hline
    2 & - & -\\
    3 & 4 & 0\\
    5 & - & -\\
    7 & 12 & -4\\
    11 & 8 & 4\\
    13 & 16 & -2\\
    17 & 16 & 2\\
    19 & 16 & 4\\
\end{tabular}

Middle columns are all multiples of four, the third column will therefore all be even.

\begin{rmk}
    Wiles (in proving Fermat's Last Theorem) the $a_p$ are the Fourier coefficients of a modular form %Todo: what
\end{rmk}
\begin{rmk}
    $E(\Q)$ infinite $\iff \prod\limits_p \dfrac{p}{\#E(\F_p)} = 0$
\end{rmk}

\subsection{Elliptic Curve Discrete Log Problem (ECDLP)}
\begin{defn}
    Take $P, Q \in E(\F_p)$. Find $n$ such that $Q = n\cdot P$, where $n$ is an additive power using the addition law of $E/F_p$
\end{defn}

\begin{exm*}
    $E/\F_{101}$, $y^2 = x^3 + x + 3$. $P = (46, 83)$, $Q = (31, 63)$
\end{exm*}
How do we find $n$ such that $Q = nP$? $n = 37$ works. In other words, $\log_p Q = 37$

We need a basic algorithm to compute $n \cdot P$ quickly for $P \in E(\F_p), n > 0$. "double and add"

\begin{exm*}
    $E: y^2 = x^3 + 31x + 1000$ over $\F_{32003}$ %"My wife's favorite finite field"
\end{exm*}

Find $P$ on $E(\F_p)$. Try $x = 1 \implies y^2 = 1032$. Compute $\left(\dfrac{1032}{32003}\right) = +1 \implies y$ exists. $y = \pm 21953$. Take $P = (1, 21953)$.

Compute $1297 \cdot P$. Decompose it as a power of 2: 1297 = 1024 + 256 + 16 + 1.

$P = (1, 21953)$. $P + P = (10821, 20322), 4P = 2P + 2P = (\ldots)$

$16P = 8P + 8P = (8878, 16557)$\\
$256P = (19325, 10689)$\\
$1024P = (13434, 22968)$\\
$1297P = 1024P + 256P + 16P + P = (544, 26812)$

\begin{rmk}
    Similar to fast powering, this algorithm can also be adapted to minimize storage requirements.
\end{rmk}

\begin{rmk}
    There is no Fermat's Little Theorem here, because we don't know the order of the group
\end{rmk}

ECDLP: Recover 1297 from (544, 26812) and (1, 21953).

Best known algorithms are collision algorithms taking $O(\sqrt{p})$ steps. These are slow, which are good for cryptographic reasons.

\begin{rmk}
    For regular discrete log problem, there exist subexponential algorithms for general prime $p$. Additionally, there exist this idea of "bad primes" $p$, which we are able to break even faster. Here, the best algorithm is obviously exponential.
\end{rmk}

\begin{rmk}
    In essence, Shor's algorithm is really good at computing orders of elements mod $p$ very quickly
\end{rmk}

\subsection{Collision Algorithms} These are essentially an adaptation of Baby Step -- Giant Step

$S$ finite set, $\#S = N$. Define $f : S \to S$ that is "sufficiently random".

\begin{exm*}
    $S  = \Z/n, f(x) = x^2 + 1$.
\end{exm*}

We are more interested in $S = E(\F_p)$

Given $P, Q \in E(\F_p)$

$F(A) = \begin{cases}
    A + P & x \equiv 1\pmod{3}\\
    2A & x \equiv 2\pmod{3}\\
    A + Q & x \equiv 0\pmod{3}\\
\end{cases}$ \hspace{1em} for $A \in E(\F_p) = (x, y), 0 \leq x \leq p-1$
%If you've taken differential equations, first of all my condolences

\textbf{Idea}: Fix $x_0 \in S$. $x_1 = f(x_0)$, $x_2 = f(x_1), \cdots$, discrete dynamical system

After repeatitively nesting $f$, you must eventually see some element repeat (because we are dealing with a finite set). Call the first point in the cycle you see $x_T$, the last point in the cycle $x_{T + M - 1}$, and then $x_T$ repeats as $x_{T + M}$, where $T$ and $M$ are minimum

\begin{rmk}
    In Chapter 5, How large to you expect T to be? $M + T \approx O(\sqrt{N})$
\end{rmk}

\subsection{Pollard's factorization algorithm} Assume we have $n = pq$, $S = \Z /n$, $f(x) = x^2 + 1$. $x_0 = 1$

Suppose $x_{T_n} = x_{T_n + M_n}$ is the first repeat mod $n$, $T_n = O(\sqrt{n})$. Probably, we get a repeat mod $p$ (or $q$) much much sooner: $x_{T_p} = x_{T_p + M_p}, T_p = O(\sqrt{p}) = O(n^{1/4})$. Take $\gcd(x_{T_p} - x_{T_p + M_p}, n) = p$, and we can probably recover something. 

There are really three pictures here, your $\rho$ mod $n$, mod $p$, and mod $q$.

\textbf{Implementation Problems}: You need to compute $\gcd(x_i - x_j, n)$ for every pair $i, j$, because we have no idea where this repeat is going to be. This becomes a huge number as $i$ increases. Additionally, you have to store every point, which is infeasible.

\begin{defn}[Pollard $\rho$--method]
    Traverse twice. Start with $x_0 = y_0$, and compute $x_i = f(x_i - 1)$, $y_i = f(f(y_{i + 1}))$. At each step, compute $\gcd(x_i - y_i, n)$. If it fails, throw it away. If it works, we have $x_T = x_{M + T}$.
\end{defn}

\begin{exm*}
    $n = 31861$, $f = x^2 + 1, x_0 = 1$
\end{exm*}

\begin{tabular}{c|c|c|c}
    $i$ & $x_i$ & $y_i$ & $\gcd(x_i - y_i, n)$\\
    \hline
    0 & 1 & 1 & $n$\\
    1 & 2 & 5 & 1\\
    2 & 5 & 677 & 1\\
    3 & 26 & 29508& 1\\
    4 & 677 &  27909 & 151\\
\end{tabular}

Unless we get unlucky, and $q$ hits at the exact same moment, we have that 151 is a factor of $n$.

Running time depends on the smallest prime factor $O(\sqrt{p}) \stackrel{?}{=} O(n^{1/4})$. If $p$ is much smaller, then it runs much better

\begin{rmk}
    This assumes $n$ exists. This is very bad at deciding if $n$ exists, so we're only going to apply it if we know there is one.
\end{rmk}

In practice with our elliptic curve, we calculate\\
$\begin{matrix}
    A_0 = P & B_0 = P\\
    A_1 = f(A_0) & B_1 = F(F(B_0))\\
    A_2 = f(A_1) & B_2 = F(F(B_1))\\
    \vdots & \vdots\\
\end{matrix}$\\
where at each step we check if $A_i = B_i$

\begin{rmk}
    $A_i = a_i P + a_i'Q$, $B_i = b_iP + b_i'Q$
\end{rmk}

Once we have our collision, we can regroup terms: $A_i = B_i \implies a_i P + a_i'Q = b_iP + b_i'Q \implies (a_i - b_i)P = (a_i' - b_i')Q$.

\begin{rmk}
    You need to know the order of $P \in E(\F_p)$, denoted $R$. Note that there is a separate algorithm for that, which we do not have yet. What we have done is, using order of $P$ and RH, determine $\#E(\F_p)$
\end{rmk}

Reduce $a_i, b_i \pmod{R}$

If $\gcd(b_i' -a_i', R) = 1$ then set $c \equiv (b_i' - a_i')^{-1}\pmod{R}$, so $c(a_i-b_i)P = Q$

Expected running time: $O(\sqrt{\# E(\F_p)}) = O(\sqrt{p})$

\begin{rmk}
    This is the best known general algorithm. Again, there are some cases which can be done quite fast (anomolous and supersingular), which we want to avoid.
\end{rmk}

\subsection{Elliptic Curve Diffie-Hellman (ECDHP)} Recall that the goal of Diffie-Hellman is for two parties to agree on a secret key over a public channel

\textbf{Public}: prime $p$, elliptic curve $E/\F_p$, and point $P \in E(\F_p)$

Alice and Bob want to agree on some sort of secret key. They each choose some large integer $n_A$ and $n_B$. Then compute $Q_A = n_A \cdot P$ and $Q_A = n_B \cdot P$. Alice sents $Q_A$ to Bob, and Bob sends $Q_A$ to Alice. Alice computes the left hand side, $n_AQ_B = n_An_BP = n_BQ_A$, and Bob computes the right hand side, which are of course equal.

\begin{rmk}
    In some cases you will want your key to be a point. In some contexts you want it to be a certain value, in which case you can just pick a coordinate or the sum.
\end{rmk}

If Eve can solve $ECDLP$, she recovers $n_A$ and $n_B$ from $Q_A, Q_B$ (and knowing $p, E, P$) can compute $n_AQ_B = n_BQ_A$. Therefore ECDLP solves ECDHP. There is no known way to approach ECDHP without ECDLP.

\begin{exm*}
    $p = 2411$. $E: y^2 = x^3 + 83x + 1137$. $P = (10, 571)$
\end{exm*}

Alice chose $n_A = 1211$, Bob chose $n_B = 693$. Using fast powering, they compute $n_AP = (401, 1439)$ and $n_BP = (1312, 802)$, and then they each compute $n_AQ_B =  n_BQ_A = n_An_BP = (116, 988)$

\subsection{Elliptic Curve El Gamal} Again, we're just going to adapt ECDHP to be a cryptosystem.

Choose prime $p$, elliptic curve $E/\F_p$, and point $P \in E(\F_p)$

Alice chooses $n_A$ and computes $Q = n_A P$

\textbf{Public}: prime $p$, elliptic curve $E/\F_p$, and point $P \in E(\F_p)$, $Q$

Bob wants to send message $M \in E(\F_p)$. (It is a lot harder to coerce the message into the curve than a message into an integer). Bob picks $k$, and sends $C_1 = kP$ and $C_2 = M + kQ$.

Alice receives them, and computes $C_2 - n_AC_1 = M + kQ- nA(kP) = M + kn_AP - n_AkP = M$

Once again, if you can solve ECDLP, then you can braek EC El Gamal (which is equivalent to ECDHP)

\section{Lensta's Elliptic Curve Factorization}
Analogue to Pollard's $p-1$ algorithm

Factor $n = pq$. Find $L$ such that (for $\gcd(a, N) = 1$)$a^L \equiv 1 \pmod{p}$, $a^Q \not\equiv 1\pmod{q}$, so $p = gcd(n, a^L - 1)$.
Try $L = k!$, $k = 1, 2, 3, \ldots$. Works well if $p-1$ has only smallish prime factors.

\textbf{Goal}: Factor $n = pq$

\begin{exm*}
    $n = 187$, $E: y^2 = x^3 + 3x + 7$, $P = (38, 112)$
\end{exm*}
Our curve is over $\Z/n$, which is a problem because it's not a field, and division doesn't work. Things break, but that's what we want.

Start computing $2P, 3P, 4P, \ldots$, using the normal formulas. $\lambda = \dfrac{3x^2 + A}{2y} \equiv \dfrac{338^2 + 3}{2\cdot 112} \pmod{n}$. $\gcd(224, n) = 1$, so we're safe.

$x_{2P} = \lambda^2 - 2x_P$, $y_{2P} = \lambda(x_{2P}-x_P) + y_P$, $2P = (43, 126)$.

Then use secant method for $3P = 2P + P = (54, 105)$, $4P = 3P + P = (93, 64)$

Why is this useful? Well, when we compute $5P$, things break.

$5P = 3P + 2P$. $\lambda = \dfrac{y(3P) - y(2P)}{x(3P) - x(2P)} = \dfrac{105-126}{54-43} = \dfrac{-21}{11} \pmod{n}$. We cannot compute the inverse of $11$ mod $n$, meaning that $\gcd(11, 187) \neq 1$. The computation fails, but more importantly we have a factor of $n$, which is $\gcd(11, 187) = 11$

\textbf{Explanation} $P \in E(\Z/187)$ can be reduced into both $P \in E(\Z/11)$ and $P \in E(\Z/17)$. $P \mod{11} = (5, 2)$ on $E(\F_{11})$. Turns out $5P = \O$. Our computation failed because a different formula is required to get $\O$. We don't need to know 11 is a factor to get their, much less know the order in $E(\F_11)$

\begin{rmk}
    We don't want to compute additively, because if the orders are huge, then this will take a while. However, we can use factorial like Pollard's $p-1$
\end{rmk}

Fix $P = (a, b)$, $a, b \in \Z/n$. Fix $A \in \Z/n$. Set $B = b^2 - a^3 -Aa$. Then $P$ is a point on $E: y^2 = x^3 + Ax + B$.

For $j = 2, 3, 4, \ldots$, let $Q_1 = P$, and $Q_j = j\cdot Q_{j-1} = j!P$. We still don't have to compute $j!$, since we only multiply once at each step, rather than recomputing $j!$ everytime, just like $p-1$ method.

If at step $j$ the computation fails (because the denominator in $\lambda$ is \underline{not} relatively prime to $n$), then recover a factor as $\gcd(n,$ denominator of $\lambda)$. 

\begin{rmk}
    If the gcd is $n$, pick a new $P$, $A$, and start over.
\end{rmk}

\begin{exm*}
    $n = 15811$
\end{exm*}
Pick $P = (11, 13)$, and $A =1 \implies B = 14638, E: y^2 = x^3 + x + 14638$

$P = (11, 13), Q_2 = 2P = (174, 13516)$

$3Q_2 = 2Q_2 + Q_2: \lambda = \dfrac{3516 - 13}{174 -11}$. 174 -11 = 163, $\gcd(n, 163) = 163$. Therefore 163 is a factor.s

Why did this work? 15811 = 163$\cdot$97. $P \in E(\Z/n) \implies E(\F_{163})$, order of 3.

\textbf{Running time}: Recall the quadratic sieve was $O(e^{\sqrt{\log n \log\log n}})$. Elliptic curve was $O(e^{\sqrt{2\log p \log\log p}})$. If $p \approx q$, then the 2 goes away and they are roughly the same. However, if $p$ is much smaller, then we will find it much quicker.

\section{Finite Fields}
\textbf{Recall}: A field $F$ is a set with binary operations $+, \cdot$ satisfying all usual algebraic axioms, including that all non-zero elements are units (meaning they have multiplicative inverses)

A finite field is a field with a finite number of elements. 

\begin{exm*}
    $\Z/n$
\end{exm*}
The units in here are the numbers relatively prime to the modulus $n$. If we want all nonzero elements to be units, then we obviously want $n$ to be prime, which we typically denote $\F_p = \Z/p$. 

\subsection{Preliminaries} Are there other finite fields? Yes there are, there are infinitely many, but there aren't that many.

\begin{thm}
    There exists a field of size $n$ if and only if $n = p^k$ for a prime $p$ and $k \geq 1$
\end{thm}
\begin{thm}
    If $F$ and $F'$ are two finite fields with the same order, then they are isomorphic
\end{thm}

Write $\F_p^n$ for "the" field of $p^n$ elements

\textbf{Why are we doing this?} It is very easy for a computer to play with $\Z/2$, but it's not very big. However, if you can pass it $F_2^{100}$, that's a lot bigger and a lot more complicated. Also when we get to torsion points, it's a lot easier to fixed $p$ and vary $n$.

\begin{exm*}
    Build using polynomial rings 
\end{exm*}
$\F_p[X]=$ ring of polynomials in $X$ with coefficients in $\F_p$. Elements look like $a_nX^n + a_{n-1}X^{n-1} + \ldots + a_0 \in \F_p[X], a_i \in \F_p$

We have a theory of divisibility: $f | g \iff fg = g$ for some $h \in \F_p[X]$. 

If we have $f, g \in \F_p[X], g\neq 0$. Then there exist a pair of polynomials $q$ and $r$ with deg$r$ < deg$g$ such that $f = gq + r$. This directly implies unique factorization into irreducible polynomials in $\F_p[X]$. 

\begin{defn}
    $f\in \F_p[X]$ is irreducible if $f$ has no non-constant divisors of smaller degree
\end{defn}
My note: this definition is for $\F_p$ since it is a field, this is weaker than general irreducibility.

\begin{exm*}
    $p = 2$, irreducible polynomials
\end{exm*}
Degree 0, none. Degree 1, $X$, $X+1$.

Degree 2 has four polynomials: $x^2 = x\cdot x$, $x^2 + x = x(x + 1)$, $x^2 + 1 = (x+1)^2$, and $x^2 + x + 1$, which is irreducible. 

We want to look for polynomials with a non-zero constant term, and an odd amount of terms. Degree 3 has two such: $x^3 + x^2 + 1$ and $x^3 + x + 1$.

Now with degree 4, we don't need to have a root to reduce. The four without roots are $x^4 + x^3 + 1$, $x^4 + x^2 + 1$, $x^4 + x + 1$, and $x^4 + x^3 + x^2 + x + 1$. However, the only way to get a degree 4 as a product of irreducible quadratics is to square our only irreducible quadratic, getting $(x^2 + x + 1)^1 = x^4 + x^2 + 1$

You can use induction and unique factorization to get a precise formular for the number of irreducible polynomials of any degree.

\subsection{Constructing a finite field of prime power size} Find irreducible polynomial $f\in \F_p[X]$ with deg$f = n$.

Quotient rings $\F_p[X]/f(x)$ are polynomials modulo $f$. For $g, h\in \F_p[X]$: $g + h$ is still degree $< n$, so it's already in here. $g\cdot h$, apply division to $gh$ and $f$ to get $r$'s degree down below $f$'s. Set $g\cdot h = r$. Then this is "the" finite field $\F_{p^n}$

\begin{exm*}
    $\F_4 = \F_2[X]/(x^2 + x + 1)$
\end{exm*}
elements are $\{0, 1, X, X+1\}$. Most are obvious except $x\cdot x = x^2 = 1(x^2 + x + 1) + x + 1$, so $x^2 = x + 1$. $(x + 1)^2 + (x^2 + x + 1) + x$, and $x(x+1) = (x^2 + x + 1) + 1 = 1$

\begin{exm*}
    $\F_{27} = \F_3[x]/(x^3 + 2x + 1)$
\end{exm*}
The elements will be quadratic polynomials with coefficients in $\F_3$

\begin{rmk}
    Finite fields are cyclic, so $\F_{27}$ will have an element with order 26.
\end{rmk}

\begin{rmk}
    Fix $n \geq 1$, and take $x^{p^n}-x$, this factors exactly as a product of every irreducible polynomial of degree dividing $n$
\end{rmk}

\begin{rmk}
    $\F_{p^2}$. If $p\equiv 3\pmod{4}$ then $\left(\dfrac{-1}{p}\right) = -1$ (-1 is not a square $\mod{p}$) It follows that $x^2 + 1$ is irreducible in $\F_p[X]$.
\end{rmk}
$p \equiv 3\pmod{4}$, $\F_{p^2} = \F_p[X]/x^2 + 1 = \F_p[i] = \{a + bi | a, b \in \F_p\}, i^2 = -1$.

\section{Elliptic Curves over Finite Fields (again)}
$E: y^2 = x^3 + ax + b$, with $a, b \in \F_{p^n}$. We always assume $a, b \in \F_p$. $\Delta = -4a^3-27b^2$, $\Delta \neq 0$

This is where the book concedes that this formulata for $\Delta$ is incomplete. $\Delta = 16(-4a^3 - 27b^2)$ so if $p = 2, \Delta = 0$ automatically.

Generalized Weierstrass equations $y^2 + a_1xy + a_3y = x^3 + a_2x^2 + a_4x + a_6$, $a_i \in \F_p$. Equation for $\Delta$ is really complicated in terms of $a$'s, but we need it to not be zero.

The group law still works, formaulas are just more complicated.

Look at $E(\F_{p^n})$ as $n$ varies

\begin{exm*}
    $p = 3$, $E: y^2 = x^3 + x + 1$
\end{exm*}
\begin{tabular}{c|c}
    $n$ & $\#E(\F_{3^n})$\\
    \hline
    1 & 4\\
    2 & 16 \\
    3 & 28\\
    4 & 64\\
    5 & 244\\
    6 & 784\\
\end{tabular}

We still have the Riemann hypothesis, but for $|\#E(\F_{p^n}) - p^n - 1 | \leq 2p^{n/2}$

\textbf{More precise statement}: $t = p + 1 - \#E(\F_p)$ so $|t| \leq 2\sqrt{p}$. Consider $x^2 - tz + p$. 

Let $\alpha, \beta\in \C$ be the complex roots $x^2 - tz + p = (z - \alpha)(z - \beta)$. Note this means $\alpha + \beta = t$, and $\alpha\beta = p$. 

Then $\#E(\F_{p^n}) = p^n + 1 - \alpha^n - \beta^n$

\begin{exm*}
    $p = 3$
\end{exm*}
$z^2 + 3 = (z + \sqrt{3}i)(z - \sqrt{3}i)$, $\alpha = \sqrt{3}i$, $\beta = -\sqrt{3}i$

$\#E(\F_{3^n}) = 3^n + 1 - (\sqrt{3})^n - (-\sqrt{3})^n = \begin{cases}
    3n + 1 & n\equiv 1 \pmod{2}\\
    3^n - 2\cdot3^{n/2}+1 & n \equiv 0 \pmod{4}\\
    3^n + 2\cdot3^{n/2}+1 & n\equiv 2 \pmod{4}\\
\end{cases}$
First case is easy because the negative remains, and $\alpha$ and $\beta$ powers cancel. For the second and third, it is a matter of what value $i$ takes on.

\begin{exm*}
    $p = 3$, $y^2 = x^3 + x + 1$
\end{exm*}
$E(\F_{3^{1000}})$. $1000 \equiv 0 \pmod{4}$, $\# = 3^{1000}-2\cdot3^{500} + 1$. This says nothing about the group structure, but we know size.

\begin{rmk}
Consider $\alpha$ and $\beta$. The Riemann hypothesis that $|t| \leq 2\sqrt{p} \iff a, b \not\in \R$. 
\end{rmk}
The key fact to this is that $\alpha \beta = p$, so if they are not real, they must be complex conjugates with modulus $\sqrt{p}$, and must add up to $t$

\subsection{Frobenius Map} No one ever seems to know his first name, he's just Frobenius, since his last name is cool.

\begin{defn}[Frobenius Map]
    $\tau : \F_{p^n} \to \F_{p^n}$, where $\tau(\alpha) = (\alpha^n)$. 
\end{defn}

\begin{lem}
    This is a ring homomorphism
\end{lem}
$\tau(\alpha\beta) = (\alpha\beta)^p = \alpha^p\beta^p = \tau(\alpha)\tau(\beta)$

$\tau(\alpha + \beta) = (\alpha + \beta)^p = \alpha^p + \ldots + \beta^p = \alpha^p + \beta^p$ since all of the middle terms are divisible by $p$.

This is an automorphism, is an element of the Galois group of this extension and so on :D.

\begin{rmk}
    $\tau(\alpha)=\alpha^p = \alpha$. $\alpha$ is a root of $x^p - x= x(x - 1)(x -2)\ldots(x - (p-1))$, so $\alpha \in \{0, 1, \ldots, p-1\} \implies \alpha \in \F_p$
\end{rmk}

\section{Weil Pairing} 
$E/\F_p$, Fix $m \geq 2$. Find $k$ such that $E(\F_p)[m] \cong \Z/m \times \Z/m$. Then pairing $e_m : E(\F_p)[m] \times E(\F_p)[m] \to \F_{p^k}^k$

\subsection{Key Properties}
$P, Q \in E(\F_{p^k})[m]$

\begin{itemize}
    \item $e_m(P, Q)^m = 1$
    \item $e_m(P, P) = 1$
    \item $e_m(P_1 + P_2, Q) = e_m(P_1, Q) \cdot e_m(P_2, Q)$, same for $Q$
    \item Non-degeneracy $e_m(P, Q) = 1$ for all $Q \in E[m] \implies P = \O$
\end{itemize}

$e_m(P, Q) = \dfrac{f_p(Q + S)}{f_p(S)}\dfrac{f_Q(-S)}{f_Q(P-S)}$ Where $S$ is a random point on $E(\F_{p^k})$, $f_P$ and $f_Q$ are rational functions on $E$ such that $div(f_P) = n[P] - n[\O]$ and $div(f_Q) = n[Q] - n[\O]$

\subsection{MOV Algorithm}
\textbf{ECDLOP}: Given $P, Q$ find (if it exists) $n \leq 1$ such that $Q = nP$.

\textbf{DLP in $\F_{p^k}$} Given $\alpha, \beta \in \F_{p^k}^k$ find (if it exists) $n \leq 1$ such that $\beta = \alpha^n$ "Index calculus" method subexponential.

To compute $e_m$, need a fast algorithm to find $f_P, f_Q$

1) $P, Q \in E(\F_{p^k})$, $\lambda =$ slope of line $\overline{PQ}$

$\lambda = \begin{cases}
    \dfrac{y_Q - y_P}{x_Q - x_P} & x_Q \neq x_P\\
    \dfrac{3x_P^2 + 1}{2y_P} & P = Q\\
    \infty & P = -Q\\
\end{cases}$

Define a rational function $f_n$ on $E$.

$g_{P, Q} = \begin{cases}
        \dfrac{y - y_P - \lambda(x - x_P)}{x + x_P = x_Q - \lambda^2} & \lambda \neq \infty\\
        x- x_p & \lambda = \infty
\end{cases}$

\textbf{Claim} $div(g_{P, Q}) = [P] + [Q] - [P + Q] - [\O]$
\end{document}


